### 一  Start up

#### 1. blade

`routes/web.php` 记录着用户请求页面的路由信息。

```php
Route::get('/', function () {
    return view('welcome');
});

Route::get('/about', function () {
    return view('about');
});

Route::get('/contact', function () {
    return view('contact');
});
```

以上三个路由表示，请求路径为 `/` ，对应着 `views/welcome.blade.php`；同理，请求路径为 `/about` 对应着 `views/about.blade.php` 



*views/about.blade.php*

```html
<title>ABOUT</title>
<x-layout> 
    <h1>About Me</h1>
    精通 C，C++，Java，Rust，Golang，Python，C# 的环境配置
    精通 Windows，Linux 操作系统的安装和卸载
</x-layout>
```



*views/contact.blade.php*

```html
<title>CONTACT</title> 
<x-layout> 
    <h1>Email: 4399@163.com</h1>
</x-layout>
```



`x-layout` 为 conponent 语法，coponent 含义为可复用，也就是说一套公共的东西，我们单拿出来，可以被其他若干模块复用。

*views/components/layout.blade.php*

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
</head>
<body>

    <nav>
        
        <x-href href="/about" > ABOUT </x-href>
        <x-href href="/contact" > CONTACT </x-href>

    </nav>

    {{ $slot }}
</body>
</html>
```

`$slot` 可被 `x-layout` 标签内的文本替换。

这个可复用的组件中包含了另一个可复用的组件 *href.blade.php*

```php
<a {{ $attributes }} > {{ $slot }} </a>
```

`$attributes` 为标签内的属性。



#### 2. 使用 tailwindui 

网站：https://tailwindui.com/

taiwindui 是一个 css 工具包，可以让我们写 html 时 实现 css-free 。

head 标签内加入：

```html
<script src="https://cdn.tailwindcss.com"></script>
```



#### 3. 自定义变量

xxx.blade.php

```html
<h1 class="text-3xl font-bold tracking-tight text-gray-900"> {{$heading}} </h1>
```

使用组件的另一文件：

```html
<x-layout heading="ABOUT"> 
    精通 C，C++，Java，Rust，Golang，Python，C# 的环境配置
    精通 Windows，Linux 操作系统的安装和卸载
</x-layout>
```

或：

```html
<x-layout> 
    <x-slot:heading>
        ABOUT
    </x-slot:heading>
    精通 C，C++，Java，Rust，Golang，Python，C# 的环境配置
    精通 Windows，Linux 操作系统的安装和卸载
</x-layout>
```



```html
<a href="/" class="{{ request()->is('/') ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white' }} rounded-md px-3 py-2 text-sm font-medium" aria-current="page">Homepage</a>
<a href="/about" class="{{ request()->is('about') ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white' }} rounded-md px-3 py-2 text-sm font-medium">About</a>
<a href="/contact" class="{{ request()->is('contact') ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white' }} rounded-md px-3 py-2 text-sm font-medium">Contact</a>
```



#### 4. `:attribute`将`""`内的内容按表达式来看

```html
 <a href="/about"   :active="request()->is('about')">   About  </a>
```

`:active` 表示将后面 `""` 中的内容当作表达式来看待，而不是字符串。

`request()->is('about')`返回 `true` 或 `false`，但是被`""`包裹了之后，就成了`"true"` 和`"false"`，这两个字符串的真值都为`true`，因此如果直接使用：`active="request()->is('about')"` ，起不到判断的效果。



#### 5. 自定义 attribute

```html
@props(['active'])

<a class="{{ $active ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white' }} rounded-md px-3 py-2 text-sm font-medium" 
   aria-current="{{ $active ? 'page' : 'false' }}" 
   {{ $attributes }}
>  
  {{ $slot }}
</a>
```

`attributes` 表示引入 html 标签默认的属性，对于新增加的属性 `active`，不能直接引入。所以需要使用 `props` 语句进行声明。



```html
<x-nav-link href="/" :active="request()->is('/')">Homepage</x-nav-link>
<x-nav-link href="/about"   :active="request()->is('about')">   About  </x-nav-link>
<x-nav-link href="/contact" :active="request()->is('contact')"> Contact</x-nav-link>
```



```php
@php 
  # 特殊情况下可以对 active 进行修改
  $active = blablabla 
@endphp
```



#### 6. `@if @else @endif`

```html
@props(['active' => false, 'type' => 'a'])

<?php if($type === 'a') : ?> 
<a class="{{ $active ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white' }} rounded-md px-3 py-2 text-sm font-medium" 
   aria-current="{{ $active ? 'page' : 'false' }}" 
   {{ $attributes }}>  
  {{ $slot }}
</a>
<?php else : ?> 
<button class="{{ $active ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white' }} rounded-md px-3 py-2 text-sm font-medium" 
   aria-current="{{ $active ? 'page' : 'false' }}" 
   {{ $attributes }}>  
  {{ $slot }}
</button>
<?php endif ?>
```

 使用 `Laravel` 语法：

```php
@props(['active' => false, 'type' => 'a'])

@if($type === 'a')
<a class="{{ $active ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white' }} rounded-md px-3 py-2 text-sm font-medium" 
   aria-current="{{ $active ? 'page' : 'false' }}" 
   {{ $attributes }}>  
  {{ $slot }}
</a>
@else
<button class="{{ $active ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white' }} rounded-md px-3 py-2 text-sm font-medium" 
   aria-current="{{ $active ? 'page' : 'false' }}" 
   {{ $attributes }}>  
  {{ $slot }}
</button>
@endif
```



#### 7. 路由过滤

`dd` 函数，display and die，调试很好用

为不同的 `jobs` 自动生成一个展示页面

```php
Route::get("/jobs/{id}", function ($id){

}
```

laravel 语法，自动捕获 `id`，并赋值给 `function` 的参数 `id`

 ```php
 \Illuminate\Support\Arr::first($jobs, fn($job) => $job['id'] == $id);
 ```

使用 `laravel` 提供的函数，遍历数组 jobs 找到第一个匹配满足闭包条件的元素。

`fn` 这种语法是 `PHP 8` 提供的，可以将外部变量 `id` 直接捕获

最终路由函数的写法：

```php
Route::get("/jobs/{id}", function ($id) {

    $jobs = [
        [
            "id" => 1,
            "title"  => "Programmer",
            "salary" => 12000
        ],
        [
            "id" => 2,
            "title"  => "Teacher",
            "salary" => 10000
        ],
        [
            "id" => 3,
            "title"  => "Teacher",
            "salary" => 8000 
        ]
    ];

    $job = Arr::first($jobs, fn($job) => $job['id'] == $id);

    //dd($job);

    return view('job', ["job" => $job]);
});

```



jobs.blade.php

```html
<title>JOBS</title> 
<x-layout heading="JOBS"> 

    @foreach($jobs as $job) 
    <li>
        <a href="/jobs/{{ $job["id"] }}">
            <strong>{{ $job['title'] }}</strong>: Pays {{ $job["salary"] }} per month 
        </a>
    </li>
    @endforeach

</x-layout>
```



job.blase.php

```php
<title>JOB</title> 

<x-layout heading="JOB INFOMATION"> 

<h2 class="font-bold text=lg"> {{ $job['title'] }} </h2>

<p>
    This job pays {{ $job['salary'] }} per month.
</p>

</x-layout>

```



#### 8. model

```php
Route::get('/jobs', function () {
    return view('jobs', [
        'jobs' => [
            [
                "id" => 1,
                "title"  => "Programmer",
                "salary" => 12000
            ],
            [
                "id" => 2,
                "title"  => "Teacher",
                "salary" => 10000
            ],
            [
                "id" => 3,
                "title"  => "Teacher",
                "salary" => 8000 
            ]
        ]
    ]
    );
});

Route::get("/jobs/{id}", function ($id) {

    $jobs = [
        [
            "id" => 1,
            "title"  => "Programmer",
            "salary" => 12000
        ],
        [
            "id" => 2,
            "title"  => "Teacher",
            "salary" => 10000
        ],
        [
            "id" => 3,
            "title"  => "Teacher",
            "salary" => 8000 
        ]
    ];

    $job = Arr::first($jobs, fn($job) => $job['id'] == $id);

    //dd($job);

    return view('job', ["job" => $job]);
});
```

jobs 在两个路由函数中重复出现，为了提高代码的复用性，可以使用下面两种常规的方式解决：

**增加全局变量**

```php
$global = [
    [
        "id" => 1,
        "title"  => "Programmer",
        "salary" => 12000
    ],
    [
        "id" => 2,
        "title"  => "Teacher",
        "salary" => 10000
    ],
    [
        "id" => 3,
        "title"  => "Teacher",
        "salary" => 8000 
    ]
];

Route::get('/jobs', function () use ($global)  {
    return view('jobs', [
        'jobs' => $global
        ]
    );
});

Route::get("/jobs/{id}", function ($id) use ($global) {
    $job = Arr::first($global, fn($job) => $job['id'] == $id);
    return view('job', ["job" => $job]);
});
```

**使用全局静态函数**

```php
class Job 
{
    public static function all(): array
    {
        return [
                    [
                        "id" => 1,
                        "title"  => "Programmer",
                        "salary" => 12000
                    ],
                    [
                        "id" => 2,
                        "title"  => "Teacher",
                        "salary" => 10000
                    ],
                    [
                        "id" => 3,
                        "title"  => "Teacher",
                        "salary" => 8000 
                    ]
            ];
    }
}

Route::get('/jobs', function () {
    return view('jobs', [
        'jobs' => Job::all()
        ]
    );
});

Route::get("/jobs/{id}", function ($id)  {
    $job = Arr::first(Job::all(), fn($job) => $job['id'] == $id);

    return view('job', ["job" => $job]);
});
```



`app/Models/Job.php`

```php
<?php

namespace App\Models;
use Illuminate\Support\Arr;

class Job 
{
    public static function all(): array
    {
        return [
                    [
                        "id" => 1,
                        "title"  => "Programmer",
                        "salary" => 12000
                    ],
                    [
                        "id" => 2,
                        "title"  => "Teacher",
                        "salary" => 10000
                    ],
                    [
                        "id" => 3,
                        "title"  => "Teacher",
                        "salary" => 8000 
                    ]
            ];
    }

    public static function find(int $id): array 
    {
        return Arr::first(static::all(), fn($job) => $job['id'] == $id);
    }

}
```



web.php

```php
Route::get("/jobs/{id}", function ($id)  {
    $job = Job::find($id);
	return view('job', ["job" => $job]);
});
```



### 二 Eloquent 

#### 1. 建表 `php artisan migrate` 

```shell
php artisan db:show

  SQLite ...................................................................... 3.31.1
  Database .................................................................... database/database.sqlite
  Host ........................................................................
  Port ........................................................................
  Username ....................................................................
  URL .........................................................................
  Open Connections ............................................................
  Tables ...................................................................... 9
```

删除掉 `database/database.sqlite`

随后运行命令：

```php
─root at VM-4-14-ubuntu in ~/php/test 24-06-01 - 17:26:18
╰─○ php artisan migrate

 WARN  The SQLite database configured for this application does not exist: database/database.sqlite.

 ┌ Would you like to create it? ────────────────────────────────┐
 │ Yes                                                          │
 └──────────────────────────────────────────────────────────────┘

  INFO  Preparing database.
  Creating migration table ................................................................ 35.14ms DONE

  INFO  Running migrations.
  0001_01_01_000000_create_users_table .................................................... 91.96ms DONE
  0001_01_01_000001_create_cache_table .................................................... 19.05ms DONE
  0001_01_01_000002_create_jobs_table ..................................................... 86.32ms DONE
```

##### `php artisan migrate:fresh` 删表重建

查看 `User` 表的信息：

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-01 - 17:51:25
╰─○ php artisan db:table

 ┌ Which table would you like to inspect? ──────────────────────┐
 │ users                                                        │
 └──────────────────────────────────────────────────────────────┘
 
  users .......................................................................................................
  Columns ................................................................................................... 8
  Size ................................................................................................ 8.00 KB

  Column ................................................................................................. Type
  id integer, autoincrement ........................................................................... integer
  name varchar ........................................................................................ varchar
  email varchar ....................................................................................... varchar
  email_verified_at datetime, nullable ............................................................... datetime
  password varchar .................................................................................... varchar
  remember_token varchar, nullable .................................................................... varchar
  created_at datetime, nullable ...................................................................... datetime
  updated_at datetime, nullable ...................................................................... datetime

  Index .......................................................................................................
  primary id .......................................................................................... primary
  users_email_unique email ............................................................................. unique

```

 `database/migrations/0001_01_01_000000_create_users_table.php/` 表信息如下：

```php
Schema::create('users', function (Blueprint $table) {
    $table->id();
    $table->string('name');
    $table->string('email')->unique();
    $table->timestamp('email_verified_at')->nullable();
    $table->string('password');
    $table->rememberToken();
    $table->timestamps();
});
```

修改 `database/migrations/0001_01_01_000000_create_users_table.php/`

```php
Schema::create('users', function (Blueprint $table) {
    $table->id();
    $table->string('first_name');
    $table->string('last_name');
    $table->string('email')->unique();
    $table->timestamp('email_verified_at')->nullable();
    $table->string('password');
    $table->rememberToken();
    $table->timestamps();
});
```

执行命令：

```php
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-01 - 17:51:29
╰─○ php artisan migrate:fresh

  Dropping all tables ............................................................................ 12.27ms DONE

   INFO  Preparing database.

  Creating migration table ....................................................................... 18.85ms DONE

   INFO  Running migrations.

  0001_01_01_000000_create_users_table .......................................................... 140.50ms DONE
  0001_01_01_000001_create_cache_table ........................................................... 34.60ms DONE
  0001_01_01_000002_create_jobs_table ............................................................ 71.66ms DONE
```

查看 `user` 表信息：

```php
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-01 - 17:51:43
╰─○ php artisan db:table

 ┌ Which table would you like to inspect? ──────────────────────┐
 │ users                                                        │
 └──────────────────────────────────────────────────────────────┘

  users .......................................................................................................
  Columns ................................................................................................... 9
  Size ................................................................................................ 8.00 KB

  Column ................................................................................................. Type
  id integer, autoincrement ........................................................................... integer
  first_name varchar .................................................................................. varchar
  last_name varchar ................................................................................... varchar
  email varchar ....................................................................................... varchar
  email_verified_at datetime, nullable ............................................................... datetime
  password varchar .................................................................................... varchar
  remember_token varchar, nullable .................................................................... varchar
  created_at datetime, nullable ...................................................................... datetime
  updated_at datetime, nullable ...................................................................... datetime

  Index .......................................................................................................
  primary id .......................................................................................... primary
  users_email_unique email ............................................................................. unique
```

`Laravel` 根据 `migration` 目录下面的 `php` 文件建表，使用 `migrate:fresh` 删除旧表创建新表

##### `php artisan make:migration` 新增表规则

```
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-02 - 0:49:54
╰─○ php artisan make:migration

 ┌ What should the migration be named? ─────────────────────────┐
 │ create_job_listing_table                                     │
 └──────────────────────────────────────────────────────────────┘

 INFO  Migration [database/migrations/2024_06_01_165716_create_job_listing_table.php] created successfully.z
```

显示：

```php
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-02 - 0:58:27
╰─○ cat database/migrations/2024_06_01_165716_create_job_listing_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('job_listing', function (Blueprint $table) {
            $table->id();
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('job_listing');
    }
};
```

执行 `php artisan migrate`根据我们新创建的 php 文件创建表

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-02 - 1:10:27
╰─○ php artisan migrate

   INFO  Running migrations.

  2024_06_01_165716_create_job_listing_table .......................................................................................... 44.09ms DONE
```



#### 2. Meet `Eloquent`

将类 `Job` 与 `job_listing` 表相关联。

```php
<?php

namespace App\Models;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Arr;

class Job extends Model 
{
    protected $table = 'job_listing';
}
```

一般来讲，类名 Job 对应表名 `jobs`，类名 `Path` 对应表明 `paths`

```php
Route::get('/', function () {
    $jobs = Job::all();

    dd($jobs[2]->title);

    return view('welcome');
});
```

##### `php artisan tinker`

**注意：** tinker 是将代码加载进内存的，所以修改代码后需要重启 tinker 

```shell
> App\Models\User::factory()->create()#修改代码后重试依然失败

   Illuminate\Database\QueryException  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'name' in 'field list' (Connection: mariadb, SQL: insert into `users` (`name`, `email`, `email_verified_at`, `password`, `remember_token`, `updated_at`, `created_at`) values (Prof. Abelardo Konopelski DVM, sophia71@example.org, 2024-06-03 02:03:03, $2y$12$OfsAWT.3hdMuA/JA8hVLAe9gLzUGwGT4feIREkpE8aaTn7htgHOf6, Mslv0cz87Z, 2024-06-03 02:03:03, 2024-06-03 02:03:03)).

>
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 10:06:47
╰─○ php artisan tinker
Psy Shell v0.12.3 (PHP 8.3.7 — cli) by Justin Hileman
> App\Models\User::factory()->create()
= App\Models\User {#5090
    first_name: "Corene",
    last_name: "Jast",
    email: "tyrese.sporer@example.org",
    email_verified_at: "2024-06-03 02:06:51",
    #password: "$2y$12$mL0ND21QgYVWTdESy3kLlOk04PJ2rW553IjvIX7ZUmQEwy6s9jlM6",
    #remember_token: "7m2SZyVdVY",
    updated_at: "2024-06-03 02:06:51",
    created_at: "2024-06-03 02:06:51",
    id: 1,
  }
```





**报错**：`Add [title] to fillable property to allow mass assignment on [App\Models\Job].`

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-02 - 21:21:09
╰─○ php artisan tinker
Psy Shell v0.12.3 (PHP 8.3.7 — cli) by Justin Hileman
> App\Models\Job::create(['title': 'pliot', 'salary': '$1,000,000']);
Illuminate\Database\Eloquent\MassAssignmentException  Add [title] to fillable property to allow mass assignment on [App\Models\Job].
```

修改 `Job` 类：

- `fillable` 属性表示可以同时赋值的属性集合
- `guarded` 表示不能同时赋值的属性集合，`$guarded = []`表示所有属性都可以同时赋值

```php
class Job extends Model 
{
    protected $table = 'job_listing';
    protected $fillable = ['title', 'salary'];
}
```

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-02 - 21:31:57
╰─○ php artisan tinker
Psy Shell v0.12.3 (PHP 8.3.7 — cli) by Justin Hileman
> App\Models\Job::create(['title'=> 'pliot', 'salary'=> '$1,000,000']);
= App\Models\Job {#5039
    title: "pliot",
    salary: "$1,000,000",
    updated_at: "2024-06-02 13:34:09",
    created_at: "2024-06-02 13:34:09",
    id: 4,
  }
```

现在数据库表中就插入了一条新值：

```shell
> App\models\Job::all()
= Illuminate\Database\Eloquent\Collection {#5032
    all: [
      App\Models\Job {#5028
        id: 1,
        title: "Programmer",
        salary: "$12000",
        created_at: null,
        updated_at: null,
      },
      App\Models\Job {#5029
        id: 2,
        title: "Teacher",
        salary: "$10000",
        created_at: null,
        updated_at: null,
      },
      App\Models\Job {#5016
        id: 3,
        title: "Teacher",
        salary: "$8000",
        created_at: null,
        updated_at: null,
      },
      App\Models\Job {#5015
        id: 4,
        title: "pliot",
        salary: "$1,000,000",
        created_at: "2024-06-02 13:34:09",
        updated_at: "2024-06-02 13:34:09",
      },
    ],
  }

> $job = App\Models\Job::find(4)
= App\Models\Job {#5020
    id: 4,
    title: "pliot",
    salary: "$1,000,000",
    created_at: "2024-06-02 13:34:09",
    updated_at: "2024-06-02 13:34:09",
  }

> $job->title
= "pliot"

> $job->salary
= "$1,000,000"

> $job->created_at
= Illuminate\Support\Carbon @1717335249 {#5027
    date: 2024-06-02 13:34:09.0 UTC (+00:00),
  }

> $job->delete()
= true

```



#### 3. Model Factories

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-02 - 21:52:11
╰─○ php artisan make:model Comment

   INFO  Model [app/Models/Comment.php] created successfully.
```

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-02 - 21:55:28
╰─○ php artisan make:model Post -m

   INFO  Model [app/Models/Post.php] created successfully.

   INFO  Migration [database/migrations/2024_06_02_135548_create_posts_table.php] created successfully.
```



*UseFactory.php*

```php
public function definition(): array
{
    return [
        'first_name' => fake()->firstName(), 
        'last_name' => fake()->lastName(),
        'email' => fake()->unique()->safeEmail(),
        'email_verified_at' => now(),
        'password' => static::$password ??= Hash::make('password'),
        'remember_token' => Str::random(10),
    ];
}
```

数据库表

```mysql
mysql> describe users;
+-------------------+-----------------+------+-----+---------+----------------+
| Field             | Type            | Null | Key | Default | Extra          |
+-------------------+-----------------+------+-----+---------+----------------+
| id                | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| first_name        | varchar(255)    | NO   |     | NULL    |                |
| last_name         | varchar(255)    | NO   |     | NULL    |                |
| email             | varchar(255)    | NO   | UNI | NULL    |                |
| email_verified_at | timestamp       | YES  |     | NULL    |                |
| password          | varchar(255)    | NO   |     | NULL    |                |
| remember_token    | varchar(100)    | YES  |     | NULL    |                |
| created_at        | timestamp       | YES  |     | NULL    |                |
| updated_at        | timestamp       | YES  |     | NULL    |                |
+-------------------+-----------------+------+-----+---------+----------------+
9 rows in set (0.00 sec)

mysql>
```

使用 tinker 调试：

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 10:06:47
╰─○ php artisan tinker
Psy Shell v0.12.3 (PHP 8.3.7 — cli) by Justin Hileman
> App\Models\User::factory()->create()
= App\Models\User {#5090
    first_name: "Corene",
    last_name: "Jast",
    email: "tyrese.sporer@example.org",
    email_verified_at: "2024-06-03 02:06:51",
    #password: "$2y$12$mL0ND21QgYVWTdESy3kLlOk04PJ2rW553IjvIX7ZUmQEwy6s9jlM6",
    #remember_token: "7m2SZyVdVY",
    updated_at: "2024-06-03 02:06:51",
    created_at: "2024-06-03 02:06:51",
    id: 1,
  }

>
```

这会向 user 表中插入一段新的记录。

```shell
> App\Models\User::factory(99)->create()
```

创建 99 条新的数据。

![1.png](https://s2.loli.net/2024/06/03/DReX29AkfsHKYPT.png)



```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 10:20:56
╰─○ php artisan make:factory JobFactory

 INFO  Factory [database/factories/JobFactory.php] created successfully.
```

接下来我们想要对 `job`  对应的数据表进行数据操作，我们需要确保 `UserFactory` 已经被引入：

`app/Models/Job.php` 

```php
<?php

namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Arr;

class Job extends Model 
{
    use HasFactory;
    
    protected $table = 'job_listing';

    protected $fillable = ['title', 'salary'];
}
```

启动 tinker：

```shell

> App\Models\Job::factory()->create()
= App\Models\Job {#5086
    title: "Staff Psychologist",
    salary: "3000 USD",
    updated_at: "2024-06-03 02:39:08",
    created_at: "2024-06-03 02:39:08",
    id: 5,
  }
```



UserFactory.php 中有一个函数：

```php
/**
 * Indicate that the model's email address should be unverified.
 */
public function unverified(): static
{
    return $this->state(fn (array $attributes) => [
        'email_verified_at' => null,
    ]);
}
```

我们可以用下面的方式进行调用：

```shell
> App\Models\User::factory()->unverified()->create()
= App\Models\User {#5058
    first_name: "Garrison",
    last_name: "Crist",
    email: "ezra70@example.com",
    email_verified_at: null,
    #password: "$2y$12$1V.bSBuSzsfwa87glgKewuFYXys1I23Lmg28eYB6uIz9roCv4/4D2",
    #remember_token: "DbU52Yhy0p",
    updated_at: "2024-06-03 02:43:38",
    created_at: "2024-06-03 02:43:38",
    id: 101,
  }
```

当然，我们可以在我们自己的 JobFactory 中创建这种函数，这种函数一般用于性能测试或者验证Admin权限：

```php
class JobFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'title' => fake()->jobTitle(),
            'salary' => "3000 USD"
        ];
    }

    public function NoJob(): static
    {
        return $this->state(fn (array $attributes) => [
            'title' => 'lost job',
        ]);
    }

    public function NoSalary(): static
    {
        return $this->state(fn (array $attributes) => [
            'salary' => '102',
        ]);
    }
}
```

使用方法：

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 10:46:46
╰─○ php artisan tinker
Psy Shell v0.12.3 (PHP 8.3.7 — cli) by Justin Hileman
> App\Models\Job::factory()->Nojob()->Nosalary()->create()
= App\Models\Job {#5100
    title: "lost job",
    salary: "102",
    updated_at: "2024-06-03 02:47:01",
    created_at: "2024-06-03 02:47:01",
    id: 6,
  }
```



##### 为 `job` 增加一个 `employer_id` 外键

```php
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 10:50:21
╰─○ php artisan make:model Employer -m

   INFO  Model [app/Models/Employer.php] created successfully.

   INFO  Migration [database/migrations/2024_06_03_025031_create_employers_table.php] created successfully.
```

删除 `app/Models/Employer.php` 通过命令生成 `model` 和 `factory`：

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 11:04:29
╰─○ php artisan make:model Employer -f

   INFO  Model [app/Models/Employer.php] created successfully.

   INFO  Factory [database/factories/EmployerFactory.php] created successfully.
```

*EmployerFactory.php*

```php
class EmployerFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => fake()->company()
        ];
    }
}
```

*JobFactory.php*

```php
use App\Models\Employer;

public function definition(): array
{
    return [
        'title' => fake()->jobTitle(),
        'salary' => "3000 USD",
        'employer_id' => Employer::factory() #使用 employer 被生成时的id作为外键
    ];
}
```

`tinker`:

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 11:32:07
╰─○ php artisan tinker
Psy Shell v0.12.3 (PHP 8.3.7 — cli) by Justin Hileman
> App\Models\Job::factory(10)->create()
= App\Models\Job {#5099
    employer_id: 1,
    title: "Plating Operator OR Coating Machine Operator",
    salary: "3000 USD",
    updated_at: "2024-06-03 03:32:10",
    created_at: "2024-06-03 03:32:10",
    id: 1,
  }
  ...
```

![](https://s2.loli.net/2024/06/03/1EKa4iSfedAJ2W7.png)

#### 4. Eloquent Relationship

通过 `Job` 寻找其所属的 `Employer`

修改 `database/migrations/2024_06_01_165716_create_job_listings_table.php`

```php
Schema::create('job_listings', function (Blueprint $table) {
    $table->id();
    //$table->unsignedBigInteger('employer_id');
    $table->foreignIdFor(\App\Models\Employer::class);
    $table->string('title');
    $table->string('salary');
    $table->timestamps();
});
```

修改 `app/Models/Job.php`

```php
<?php
namespace App\Models;
use App\Models\Employer;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Arr;


class Job extends Model 
{
    use HasFactory;
    
    protected $table = 'job_listing';

    protected $fillable = ['title', 'salary'];

    public function employer() 
    {
        return $this->belongsTo(Employer::class);
    }
}
```

运行 `php tinker`

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 15:18:18
╰─○ php artisan tinker
Psy Shell v0.12.3 (PHP 8.3.7 — cli) by Justin Hileman
> $job = App\Models\Job::first();
= App\Models\Job {#5030
    id: 1,
    employer_id: 1,
    title: "Plating Operator OR Coating Machine Operator",
    salary: "3000 USD",
    created_at: "2024-06-03 03:32:10",
    updated_at: "2024-06-03 03:32:10",
  }

> $job->employer;
= App\Models\Employer {#5422
    id: 1,
    name: "Bailey Group",
    created_at: "2024-06-03 03:32:10",
    updated_at: "2024-06-03 03:32:10",
  }

> $job->employer->name;
= "Bailey Group"
```

`employer()` 在 `Job` 类中是一个方法而非属性，这里使用属性的方法获取方法，`laravel` 会明白这是一个 `relationship`，注意实例从 `Job` 进入到了`Employer`。



通过 `Employer` 属于其的 `Job`

注意：`database/migrations/2024_06_03_025031_create_employers_table.php` 并不需要添加外键

```php
<?php
namespace App\Models;

use App\Models\Job;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Employer extends Model
{
    use HasFactory;

    public function jobs() 
    {
        return $this->hasMany(Job::class);
    }
}
```

启动 tinker：

```shell
> $employer = App\Models\Employer::first();
= App\Models\Employer {#5026
    id: 1,
    name: "Bailey Group",
    created_at: "2024-06-03 03:32:10",
    updated_at: "2024-06-03 03:32:10",
  }

> $employer->jobs;
= Illuminate\Database\Eloquent\Collection {#5017  
    all: [
      App\Models\Job {#5012
        id: 1,
        employer_id: 1,
        title: "Plating Operator OR Coating Machine Operator",
        salary: "3000 USD",
        created_at: "2024-06-03 03:32:10",
        updated_at: "2024-06-03 03:32:10",
      },
    ],
  }

> $employer->jobs[0]->title;
= "Plating Operator OR Coating Machine Operator"

> $employer->jobs->first();
= App\Models\Job {#5012
    id: 1,
    employer_id: 1,
    title: "Plating Operator OR Coating Machine Operator",
    salary: "3000 USD",
    created_at: "2024-06-03 03:32:10",
    updated_at: "2024-06-03 03:32:10",
  }
```

#### 5. Pivot Table and BelongsToMany Relationship

创建 Tag Model

```shell
╭─root at VM-4-14-ubuntu in ~/php/testphp artisan make:model Tag -mf

   INFO  Model [app/Models/Tag.php] created successfully.

   INFO  Factory [database/factories/TagFactory.php] created successfully.

   INFO  Migration [database/migrations/2024_06_03_075628_create_tags_table.php] created successfully.
```

修改 `database/migrations/` 目录下的 tag 表信息：

```php
<?php

use \App\Models\Job;
use \App\Models\Tag;
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('tags', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->timestamps();
        });

        Schema::create('job_tag', function (Blueprint $table) {
            $table->id();
            #增加约束，当job信息和tag信息删除时，删除该记录
            $table->foreignIdFor(Job::class, 'job_listing_id')
                    ->constrained()->cascadeOnDelete();
            $table->foreignIdFor(Tag::class)
                    ->constrained()->cascadeOnDelete();
            $table->timestamps();
        });

    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('tags');
        #两张表，后一张表也需要删除掉
        Schema::dropIfExists('job_tag');
    }
};
```

*app/Models/Job.php*

```php
public function tag()
{
    return $this->belongsToMany(Tag::class, foreignPivotKey: 'job_listing_id');
}
```

*app/Models/Tag.php*

```php
public function job() 
{
    return $this->belongsToMany(Job::class, relatedPivotKey: 'job_listing_id');
}
```

现在我们就可以根据 `Job` 找到对应的 `Tag`，或者根据 `Tag` 找到对应的 `Job` 了：

```php
> $job = App\Models\Job::find(2);
= App\Models\Job {#5024
    id: 2,
    employer_id: 11,
    title: "Medical Transcriptionist",
    salary: "3000 USD",
    created_at: "2024-06-03 09:26:18",
    updated_at: "2024-06-03 09:26:18",
  }

> $job->tag;
= Illuminate\Database\Eloquent\Collection {#5832
    all: [
      App\Models\Tag {#5782
        id: 1,
        name: "C++",
        created_at: null,
        updated_at: null,
        pivot: Illuminate\Database\Eloquent\Relations\Pivot {#6048
          job_listing_id: 2,
          tag_id: 1,
        },
      },
      App\Models\Tag {#6050
        id: 2,
        name: "Java",
        created_at: null,
        updated_at: null,
        pivot: Illuminate\Database\Eloquent\Relations\Pivot {#6047
          job_listing_id: 2,
          tag_id: 2,
        },
      },
    ],
  }

> $tag = App\Models\Tag::find(2);
= App\Models\Tag {#5016
    id: 2,
    name: "Java",
    created_at: null,
    updated_at: null,
  }

> $tag->job;
= Illuminate\Database\Eloquent\Collection {#6145
    all: [
      App\Models\Job {#5031
        id: 1,
        employer_id: 1,
        title: "wxc",
        salary: "0",
        created_at: null,
        updated_at: null,
        pivot: Illuminate\Database\Eloquent\Relations\Pivot {#5833
          tag_id: 2,
          job_listing_id: 1,
        },
      },
      App\Models\Job {#6110
        id: 2,
        employer_id: 11,
        title: "Medical Transcriptionist",
        salary: "3000 USD",
        created_at: "2024-06-03 09:26:18",
        updated_at: "2024-06-03 09:26:18",
        pivot: Illuminate\Database\Eloquent\Relations\Pivot {#5901
          tag_id: 2,
          job_listing_id: 2,
        },
      },
    ],
  }

```

如果我们想给 `tag` 或 `job` 新增几条对应关系：

```php
> $tag->job()->attach(7);
= null

> $tag->job()->attach(App\Models\Job::find(8));
= null
```

由于 `tinck` 在内存中调试，我们需要重新加载 `tag` 对应的 `job` 才能看到更新：

```php
> $tag->job()->get();
= Illuminate\Database\Eloquent\Collection {#6065
    all: [
      App\Models\Job {#6061
        id: 1,
        employer_id: 1,
        title: "wxc",
        salary: "0",
        created_at: null,
        updated_at: null,
        pivot: Illuminate\Database\Eloquent\Relations\Pivot {#5018
          tag_id: 2,
          job_listing_id: 1,
        },
      },
      App\Models\Job {#5017
        id: 2,
        employer_id: 11,
        title: "Medical Transcriptionist",
        salary: "3000 USD",
        title: "Medical Transcriptionist",
        salary: "3000 USD",
        created_at: "2024-06-03 09:26:18",
        updated_at: "2024-06-03 09:26:18",
        pivot: Illuminate\Database\Eloquent\Relations\Pivot {#6063
          tag_id: 2,
          job_listing_id: 2,
        },
      },
      App\Models\Job {#5023
        id: 7,
        employer_id: 16,
        title: "Manager",
        salary: "3000 USD",
        created_at: "2024-06-03 09:26:18",
        updated_at: "2024-06-03 09:26:18",
        pivot: Illuminate\Database\Eloquent\Relations\Pivot {#6060
          tag_id: 2,
          job_listing_id: 7,
        },
      },
      App\Models\Job {#5021
        id: 8,
        employer_id: 17,
        title: "Extruding Machine Operator",
        salary: "3000 USD",
        created_at: "2024-06-03 09:26:18",
        updated_at: "2024-06-03 09:26:18",
        pivot: Illuminate\Database\Eloquent\Relations\Pivot {#6062
          tag_id: 2,
          job_listing_id: 8,
        },
      },
    ],
  }
```

由于信息内容过长，我们也可以只看 `title`：

```php
> $tag->job()->get()->pluck('title');
= Illuminate\Support\Collection {#5029
    all: [
      "wxc",
      "Medical Transcriptionist",
      "Manager",
      "Extruding Machine Operator",
    ],
  }
```



pivot table&&relationship



#### 6. Eager Loading and N+1 Problem

安装 debugbar：

```
composer require barryvdh/laravel-debugbar --dev
```

`.env`中的`APP_DEBUG`必须设置为 `true`

下载这个插件，网页刷新白屏，暂时没有找出原因。



`Job::all()` 延迟加载，会根据 `Job` 的每一条记录在进行 `employer` 表的查询。

```php
Route::get('/jobs', function () {
    return view('jobs', [
        'jobs' => Job::all()
        ]
    );
});
```



`get()` 对应数据库语句 `select *`，如果数据库数据很多，这条语句要小心使用。

```php
Route::get('/jobs', function () {
    $jobs = Job::with('employer')->get();
    return view('jobs', [
        'jobs' => $jobs
        ]
    );
});
```

1. `Job::` 部分表示我们正在使用 `Job` 模型进行查询操作。
2. `with('employer')` 部分是一个 Eloquent 关联查询方法,用于指定在获取 `Job` 记录时同时获取其关联的 `Employer` 模型记录。这里假设 `Job` 模型和 `Employer` 模型之间存在一对一或一对多的关联关系,通过 `with` 方法可以预加载关联数据,避免后续的 N+1 查询问题。
3. `get()` 方法用于从数据库中实际获取所有符合条件的 `Job` 记录及其关联的 `Employer` 记录。

这样可以有效的减少数据库的查询次数。

##### 将 MySQL 的查询输出到日志

```mysql
mysql> show variables like 'general_log';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| general_log   | OFF   |
+---------------+-------+
1 row in set (0.00 sec)

mysql> set global general_log=on;
Query OK, 0 rows affected (0.01 sec)

mysql> show variables like 'general_log';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| general_log   | ON    |
+---------------+-------+
1 row in set (0.00 sec)

mysql> show variables like 'log_output';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| log_output    | FILE  |
+---------------+-------+
1 row in set (0.00 sec)

mysql> show variables like 'general_log_file';
+------------------+-----------------------------------+
| Variable_name    | Value                             |
+------------------+-----------------------------------+
| general_log_file | /var/lib/mysql/VM-4-14-ubuntu.log |
+------------------+-----------------------------------+
1 row in set (0.00 sec)
```

参考：https://blog.csdn.net/csd_nuser/article/details/121236625

 当我们直接使用 `Job::all()` 时，打开 `localhost:8080/jobs`页面，与数据表关联的查询语句如下：

```shell
2024-06-03T13:24:15.936360Z        92 Execute   select * from `job_listings`
2024-06-03T13:24:15.938654Z        92 Execute   select * from `employers` where `employers`.`id` = 1 limit 1
2024-06-03T13:24:15.939545Z        92 Execute   select * from `employers` where `employers`.`id` = 11 limit 1
2024-06-03T13:24:15.940373Z        92 Execute   select * from `employers` where `employers`.`id` = 12 limit 1
2024-06-03T13:24:15.941246Z        92 Execute   select * from `employers` where `employers`.`id` = 13 limit 1
2024-06-03T13:24:15.942090Z        92 Execute   select * from `employers` where `employers`.`id` = 14 limit 1
2024-06-03T13:24:15.942897Z        92 Execute   select * from `employers` where `employers`.`id` = 15 limit 1
2024-06-03T13:24:15.943635Z        92 Execute   select * from `employers` where `employers`.`id` = 16 limit 1
2024-06-03T13:24:15.944354Z        92 Execute   select * from `employers` where `employers`.`id` = 17 limit 1
2024-06-03T13:24:15.945026Z        92 Execute   select * from `employers` where `employers`.`id` = 18 limit 1
2024-06-03T13:24:15.945758Z        92 Execute   select * from `employers` where `employers`.`id` = 19 limit 1
2024-06-03T13:24:15.946453Z        92 Execute   select * from `employers` where `employers`.`id` = 20 limit 1
```

 当我们将关联表合并查询后，MySQL 查询语句如下：

```mysql
2024-06-03T13:14:49.362368Z        91 Execute   select * from `job_listings`
2024-06-03T13:14:49.363730Z        91 Execute   select * from `employers` where `employers`.`id` in (1, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20)
```



##### 禁止延迟加载

打开 `app/Providers/AppServiceProvider.php`

```php
public function boot(): void
{
    Model::preventLazyLoading();
}
```

将 `route.php` 中对应页面的访问方式修改为：

```php
Route::get('/jobs', function () {
    return view('jobs', [
        'jobs' => Job::all()
        ]
    );
});
```

刷新页面看到错误：

```
Attempted to lazy load [employer] on model [App\Models\Job] but lazy loading is disabled.
```



#### 7. Pagination

修改 `/jobs` 的 `route`：

```php
Route::get('/jobs', function () {
    $jobs = Job::with('employer')->paginate(3);

    return view('jobs', [
        'jobs' => $jobs
        ]
    );
});
```

修改对应页面的 blade：

```php
<div>{{ $jobs->links() }}</div>
```

刷新页面即可看到：

![3.png](https://s2.loli.net/2024/06/03/nrIaZWzlTgLmsDX.png)

展示首页数据库的查询语句为：

```mysql
2024-06-03T13:47:31.554205Z       101 Execute   select count(*) as aggregate from `job_listings`
2024-06-03T13:47:31.563407Z       101 Execute   select * from `job_listings` limit 3 offset 0
2024-06-03T13:47:31.564871Z       101 Execute   select * from `employers` where `employers`.`id` in (1, 11, 12)
```

使用 `$jobs = Job::with('employer')->simplePaginate(3)` 进行分页， SQL 语句为：

```mysql
2024-06-03T14:08:46.908570Z       103 Execute   select * from `job_listings` limit 4 offset 0
2024-06-03T14:08:46.910125Z       103 Execute   select * from `employers` where `employers`.`id` in (1, 11, 12, 13)
```

不会预先获取条目的数量进行页数计算。

使用 `$jobs = Job::with('employer')->cursorPaginate(3);` 进行分页，SQL 语句为：

```mysql
2024-06-03T14:13:09.257669Z       104 Execute   select * from `job_listings` order by `job_listings`.`id` asc limit 4
2024-06-03T14:13:09.259429Z       104 Execute   select * from `employers` where `employers`.`id` in (1, 11, 12, 13)
```

不使用根据偏移的查询，这在表很大的时候比较高效。



```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-03 - 21:51:11
╰─○ php artisan vendor:publish

 ┌ Which provider or tag's files would you like to publish? ────┐
 │ Tag: laravel-pagination                                      │
 └──────────────────────────────────────────────────────────────┘

   INFO  Publishing [laravel-pagination] assets.

  Copying directory [vendor/laravel/framework/src/Illuminate/Pagination/resources/views] to [resources/views/vendor/pagination]  DONE
```

在 `app/Providers/AppServiceProvider.php` 中可以修改分页的样式：

```php
public function boot(): void
{
    //
    Model::preventLazyLoading();
    //Paginator::useBooststrapFive();
}
```



#### 8. Database seeders

`database/seeders/DatabaseSeeder.php`

```php
class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        // User::factory(10)->create();
        User::factory()->create([
            'name' => 'Test User',
            'email' => 'test@example.com',
        ]);
    }
}
```

执行命令：

```shell
php artisan db:seed
```

可以看到 `users` 表插入了一条数据。

```shell
php artisan migrate:fresh
```

则会将所有 `seed` 产生的数据清理了。

`--seed` 可以在重新建表后执行 `db:seed` 命令

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-04 - 10:33:34
╰─○ php artisan migrate:fresh --seed

  Dropping all tables .................................................................................... 323.78ms DONE

   INFO  Preparing database.

  Creating migration table ................................................................................ 78.97ms DONE

   INFO  Running migrations.

  0001_01_01_000000_create_users_table ................................................................... 320.73ms DONE
  0001_01_01_000001_create_cache_table ................................................................... 134.38ms DONE
  0001_01_01_000002_create_jobs_table .................................................................... 289.66ms DONE
  2024_06_01_165716_create_job_listings_table ............................................................. 46.95ms DONE
  2024_06_03_025031_create_employers_table ................................................................ 63.30ms DONE
  2024_06_03_075628_create_tags_table .................................................................... 353.72ms DONE


   INFO  Seeding database.
```

修改 *DatabaseSeeder.php* 文件

```php
class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        // User::factory(10)->create();
        User::factory()->create([
            'first_name' => 'Shepard',
            'last_name'  => 'Wang',
            'email'      => 'test@example.com'
        ]);

        Job::factory(20)->create();
    }
}
```

重新执行 `php artisan db:seed` 会得到报错，这是因为我们已经插入了一个 `user`，再次执行试图重新插入一个相同的 `user`，而 `user.email` 是 `unique` 的，所以我们首先要删除表。可以执行：

```shell
php artisan migrate:fresh --seed
```



创建新的 `seeder` ：

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-04 - 10:46:25
╰─○ php artisan make:seed

 ┌ What should the seeder be named? ────────────────────────────┐
 │ JobSeeder                                                    │
 └──────────────────────────────────────────────────────────────┘

   INFO  Seeder [database/seeders/JobSeeder.php] created successfully.
```

*JobSeeder.php*

```php
<?php

namespace Database\Seeders;

use App\Models\Job;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class JobSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        Job::factory(20)->create();
    }
}
```

*DatabaseSeeder.php* `run` 函数中加上如下代码：

```php
$this->call(JobSeeder::class);
```

执行命令：

```shell
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-04 - 10:48:26
╰─○ php artisan migrate:fresh --seed

  Dropping all tables .................................................................................... 219.16ms DONE

   INFO  Preparing database.

  Creating migration table ................................................................................ 68.79ms DONE

   INFO  Running migrations.

  0001_01_01_000000_create_users_table ................................................................... 278.54ms DONE
  0001_01_01_000001_create_cache_table .................................................................... 97.41ms DONE
  0001_01_01_000002_create_jobs_table .................................................................... 275.80ms DONE
  2024_06_01_165716_create_job_listings_table ............................................................. 61.91ms DONE
  2024_06_03_025031_create_employers_table ................................................................ 91.37ms DONE
  2024_06_03_075628_create_tags_table .................................................................... 354.19ms DONE


   INFO  Seeding database.

  Database\Seeders\JobSeeder ................................................................................... RUNNING
  Database\Seeders\JobSeeder ............................................................................... 447 ms DONE
```

如果我们只想执行 `JobSeeder`，那我们可以执行以下命令：

```php
╭─root at VM-4-14-ubuntu in ~/php/test 24-06-04 - 10:58:40
╰─○ php artisan db:seed --class=JobSeeder

   INFO  Seeding database.
```



## 问题

Laravel new project 时，无法手动选择数据库。直接跳过了所有选择

```shell
> Illuminate\Foundation\ComposerScripts::postAutoloadDump
> @php artisan package:discover --ansi

   INFO  Discovering packages.

  laravel/sail .............................................................................................................. DONE
  laravel/tinker ............................................................................................................ DONE
  nesbot/carbon ............................................................................................................. DONE
  nunomaduro/collision ...................................................................................................... DONE
  nunomaduro/termwind ....................................................................................................... DONE

79 packages you are using are looking for funding.
Use the `composer fund` command to find out more!
> @php artisan vendor:publish --tag=laravel-assets --ansi --force

   INFO  No publishable resources for tag [laravel-assets].

No security vulnerability advisories found.
> @php artisan key:generate --ansi

   INFO  Application key set successfully.

> @php -r "file_exists('database/database.sqlite') || touch('database/database.sqlite');"
> @php artisan migrate --graceful --ansi

   INFO  Preparing database.

  Creating migration table .......................................................................................... 35.72ms DONE

   INFO  Running migrations.

  0001_01_01_000000_create_users_table .............................................................................. 58.78ms DONE
  0001_01_01_000001_create_cache_table .............................................................................. 21.58ms DONE
  0001_01_01_000002_create_jobs_table ............................................................................... 58.32ms DONE

   INFO  Application ready! Build something amazing.
```









